C51 COMPILER V9.60.7.0   TASK_APP                                                          03/31/2025 21:01:40 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TASK_APP
OBJECT MODULE PLACED IN .\Objects\Task_App.obj
COMPILER INVOKED BY: D:\Keli5\C51\BIN\C51.EXE ..\User\Src\Task_App.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\User\Inc;..\Driv
                    -er\Inc;.\SYS) DEBUG OBJECTEXTEND PRINT(.\Listings\Task_App.lst) OBJECT(.\Objects\Task_App.obj)

line level    source

   1          #include "Task_App.h"
   2          
   3          extern uint32_t xdata Mysystick; //系统心跳
   4          extern uint8_t pdata Seg_Buf[8]; //数码管显示缓存
   5          extern uint8_t pdata Seg_Point[8]; //数码管小数点显示缓存
   6          extern uint8_t pdata ucLed[8]; //LED灯显示缓存
   7          extern uint8_t pdata ucRTC[3]; //时间储存 时、分、秒
   8          extern float temperature; //温度
   9          extern uint8_t RxData[5]; //串口接收到的的数据
  10          extern uint16_t Serial_Idle_Cnt; //串口空闲计时器
  11          extern uint8_t index; //指示当前接收到数据的索引
  12          extern uint8_t Adval1; //AD转换值
  13          extern uint8_t Adval2; //AD转换值
  14          extern uint8_t Distance; //距离
  15          extern uint16_t Freq; //NE555频率
  16          
  17          /*Task1 Creation Key*/
  18          void Task_Key(void)
  19          {
  20   1          static uint8_t Key_Val;
  21   1          static uint8_t Key_Down;
  22   1          static uint8_t Key_Up;
  23   1          static uint8_t Key_Old = 0; //该值初始给0 避免警告
  24   1          static bit Test_Flag = 0;
  25   1      
  26   1          Key_Val = Key_Read();
  27   1          Key_Down = Key_Val & (Key_Val ^ Key_Old);
  28   1          Key_Up = ~Key_Val & (Key_Val ^ Key_Old);
  29   1          Key_Old = Key_Val;
  30   1      
  31   1          /*Test*/
  32   1      
  33   1          switch (Key_Down)
  34   1          {
  35   2              case 8:
  36   2                  Test_Flag ^= 1;
  37   2                  memset(ucLed, Test_Flag, 8);
  38   2                  break;
  39   2              case 4: // 上一级菜单
  40   2                  Menu_MoveParent();
  41   2                  break;
  42   2      
  43   2              case 5: //下一级菜单
  44   2                  Menu_MoveChild();
  45   2                  break;
  46   2      
  47   2              case 6: //同一级 下一个菜单
  48   2                  Menu_MoveNext();
  49   2                  break;
  50   2      
  51   2              case 7: //同一级 上一个菜单
  52   2                  Menu_MovePrev();
  53   2                  break;
  54   2          }
C51 COMPILER V9.60.7.0   TASK_APP                                                          03/31/2025 21:01:40 PAGE 2   

  55   1      }
  56          
  57          /*Task2 Creation Seg Led*/
  58          void Task_Disp(void)
  59          {
  60   1          uint8_t Scan = Mysystick % 8; //显示扫描变量 只在0――7周期变
  61   1      
  62   1          Seg_Disp(Scan, Seg_Buf[Scan], Seg_Point[Scan]); //数码管显示
  63   1          LED_Disp(Scan, ucLed[Scan]); //LED显示
  64   1      }
  65          
  66          /*Task3 Creation NE555*/
  67          void Task_NE555(void)
  68          {
  69   1          TR0 = 0; //关闭TIM0计数
  70   1          ET1 = 0; //关闭TIM1中断允许
  71   1          Freq = TH0 << 8 | TL0; //获取频率
  72   1          TH0 = TL0 = 0; //手动清空计数值
  73   1          ET1 = 1; //打开TIM1中断允许
  74   1          TR0 = 1; //开启TIM0计数
  75   1      }
  76          
  77          /*Task4 Creation Buzz Motor Relay*/
  78          void Task_Periph(void)
  79          {
  80   1          static bit Flag_Buzz = 0;
  81   1          static bit Flag_Relay = 1;
  82   1      
  83   1          Periph_Set(BUZZ, Flag_Buzz);
  84   1          Periph_Set(RELAY, Flag_Relay);
  85   1      
  86   1          //500ms翻转一次继电器和蜂鸣器的电平
  87   1          Flag_Buzz ^= 1;
  88   1          Flag_Relay ^= 1;
  89   1      }
  90          
  91          /*Task5 Creation DS1302*/
  92          void Task_RTC(void)
  93          {
  94   1          RTC_Read(ucRTC);
  95   1      }
  96          
  97          /*Task6 Creation DS18B20*/
  98          void Task_Ds18b20(void)
  99          {
 100   1          temperature = Read_temperature(); //获取温度
 101   1      }
 102          
 103          /*Task7 Creation Ultrasonic*/
 104          void Task_Ul(void)
 105          {
 106   1          Distance = Distance_Get(); //获取距离
 107   1      }
 108          
 109          /*Task8 Creation Serial*/
 110          void Task_Serial(void)
 111          {
 112   1          static uint8_t psc = 0; //分频器 每1s发送一次
 113   1      
 114   1          /*模拟串口发送数据 这里是1s打印一个数据*/
 115   1          if (++psc == 4)
 116   1          {
C51 COMPILER V9.60.7.0   TASK_APP                                                          03/31/2025 21:01:40 PAGE 3   

 117   2              psc = 0;
 118   2              printf("systime:%d\r\n", (uint16_t)(Mysystick / 1000));
 119   2          }
 120   1      
 121   1          if (Serial_Idle_Cnt > 300) //300ms没接受到数据就会解析一次 这里可以自行调整
 122   1          {
 123   2              /*串口解析操作*/
 124   2              if (RxData[0] == '1')
 125   2              {
 126   3                  static bit i = 0;
 127   3                  index = 0;
 128   3                  RxData[0] = 0;
 129   3                  memset(ucLed, i, 8);
 130   3                  i ^= 1;
 131   3              }
 132   2          }
 133   1      }
 134          
 135          /*Task9 Creation PCF8591*/
 136          void Task_PCF8591(void)
 137          {
 138   1          Adval1 = AD_Read(0x41); //电位器
 139   1          Adval2 = AD_Read(0x43); //光敏
 140   1      }
 141          
 142          void Task_Seg(void)
 143          {
 144   1          memset(Seg_Buf, 10, 8); // 清空显示缓冲区
 145   1          memset(Seg_Point, 0, 8); // 清除所有小数点
 146   1          Menu_Update();
 147   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    343    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
